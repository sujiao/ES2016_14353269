# DOL实例分析&编程
标签：DOL


----------
**一、实验基础**
----------
---
**实验任务：**
 1. 修改example1，使其输出3次方数
 2. 修改example2，让3个square模块变成2个
 
---
**基本知识：**
 
 3. example中各文件的含义
 
           src文件夹：各进程（生产者，消费者，处理模块等）的功能定义，里面包含2种文件：*.c,与对应的.h，就是实现的模块，*.dot的方框的功能描述。每个模块要实现2个接口，xxx_init和xxx_fire两个函数，分别是初始化这个模块时的行为，以及运行这个模块的行为； 
           example1.xml：系统架构即模块连接方式定义，里面定义了模块与模块之间是怎么连接的，process就是功能框, sw_channel是连接线, connection就是把线的那头连到框的那头。

 4. 代码分析（以example1为例）

           generator定义生产者进程，每个模块都要写上xxx_fire（可能被执行无数次），至于xxx_init是可选择写或者不写的（只会被执行一次）。generator_init是初始化函数，将当前位置置为0，设置生产者长度。此处的local指针指向的是.h文件的_local_states结构。generator_fire 是信号产生函数。这里的代码是：如果当前位置小于生产长度length，则将x（这里是当前下标）写入到输出端，否则销毁进程。
           consumer定义消费者进程。consumer_init初始化函数，含义同generator_init。consumer_fire信号消费函数，若当前位置小于设定长度length，则读出输入端信号，并且打印；否则销毁进程。
           square定义平方进程，square_fire是信号处理函数，读入输入端信号i，将其平方后写出到输出端，也是重复length次之后就停止了。
           .xml包含进程定义，通道定义（一条线就是一条通道），连接定义（定义各个模块之间的连接,一条线会对应两个connection，就是A框的右手牵着这条线的左边， 这条线的右边牵着B框。）
  


----------
**二、实验过程**
----------
---
**改完的*.dot截图**
![example1运行截图][1]
![example1.dot][2]
![example2运行截图][3]
![example2.dot][4]

---
**具体修改方法**

       对于任务一，使其输出3次方数。输出部分定义在平方进程square.c中，信号处理函数square_fire读入输入端信号i，将其平方后写出到输出端，重复length次之后停止。此处，我们在读入输入端信号i后的平方处理修改为立方处理即可。
           
      对于实验二，让3个square模块变成2个。实例架构中的进程模块定义在xml文件中，通过值为3的变量进行迭代，定义3个square模块。此处，只需将变量值由3修改为2即可。 
         
---
**实验感想**

       本次实验比较简单，课件里已经给出了全部分析过程和实验方法，只需照着做即可。实验中出了一些小问题都是自身的问题。首先因为上周实验配置时已经有单独运行过example1，所以本次实验中无论把i修改为什么样都输出平方值，过了几天继续该实验时，没有记清打开example的位置，跑到build文件中修改去了，因为是制度文件不能修改，害的我以为虚拟机坏了，各种方法都没解决后重装了整个虚拟机，终于在配置DOL时发现了问题，应该直接进example文件夹修改，build是编译过后生成的文件，之前无法修改i的平方值也是因为没有删除整个build文件夹而是里面的小运行文件。build是编译生成文件，因为我在修改square.c后进行的是运行操作而不是编译，所以一直都是原始的结果没有修改。

       虽然白白重装了虚拟机，但在过程中发现了之前实验失败的问题并加以解决，也算是“物有所值”了。以后的实验一定要更仔细一些。


  [1]: http://i1.piimg.com/567571/bdd05343df40893f.png
  [2]: http://i1.piimg.com/567571/59bbd40db62eb207.png
  [3]: http://i1.piimg.com/567571/2676ee3e207c991d.png
  [4]: http://i1.piimg.com/567571/85be56e93e2e80c8.png